<%= render 'shared/navbar' %>

<div class="w-full px-4 sm:px-6 lg:px-8 pt-24 pb-8" data-controller="section">
  <div class="max-w-7xl mx-auto">

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
      <div>
        <h2 class="text-2xl font-extrabold text-stone-800 sm:text-3xl">
          <%= @project.name %>
        </h2>
        <p class="mt-2 text-stone-600">
          Управляйте рецептами, ингредиентами и тегами вашего проекта
        </p>
      </div>
      
      <%= link_to export_project_path(@project, format: :json), 
          download: "#{@project.name.parameterize}.json", 
          target: "_blank", 
          class: "inline-flex items-center justify-center px-4 py-2 text-sm font-semibold text-white bg-amber-600 rounded-md shadow hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors" do %>
        <svg class="w-4 h-4 mr-2 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
          <path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/>
        </svg>
        Экспортировать в JSON
      <% end %>
    </div>

    <div class="mb-8">
      <div class="flex justify-center">
        <div class="inline-flex rounded-lg border border-stone-200 bg-white p-1 shadow-sm space-x-1">
          <button data-action="click->section#showSection"
                  data-section="recipe"
                  class="flex items-center px-6 py-3 text-base font-medium rounded-md transition-colors duration-200
                        text-stone-700 hover:bg-stone-50 hover:text-stone-900 bg-amber-600 text-white"
                  data-section-target="button"
                  aria-selected="true">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
            Рецепты
          </button>
          
          <button data-action="click->section#showSection"
                  data-section="ingredient"
                  class="flex items-center px-6 py-3 text-base font-medium rounded-md transition-colors duration-200
                        text-stone-700 hover:bg-stone-50 hover:text-stone-900"
                  data-section-target="button"
                  aria-selected="false">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            Ингредиенты
          </button>
          
          <button data-action="click->section#showSection"
                  data-section="tag"
                  class="flex items-center px-6 py-3 text-base font-medium rounded-md transition-colors duration-200
                        text-stone-700 hover:bg-stone-50 hover:text-stone-900"
                  data-section-target="button"
                  aria-selected="false">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
            Теги
          </button>
        </div>
      </div>
    </div>

    <div data-section-target="recipe">
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-stone-800">Рецепты проекта</h3>
          <span class="text-sm text-stone-500"><%= @recipes.count %> рецептов</span>
        </div>
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
          <div class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200">
            <%= link_to new_project_recipe_path(@project), data: { turbo_frame: "modal" }, class: "block p-4 text-center h-full flex flex-col items-center justify-center" do %>
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-amber-50 mb-2">
                <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
              </div>
              <span class="text-sm font-medium text-stone-700">Добавить</span>
            <% end %>
          </div>
          
          <% @recipes.each do |recipe| %>
            <div id="recipe_<%= recipe.id %>" class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200 overflow-hidden">
              <%= render partial: 'recipe_card', locals: { recipe: recipe } %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div data-section-target="ingredient" class="hidden">
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-stone-800">Ингредиенты проекта</h3>
          <span class="text-sm text-stone-500"><%= @ingredients.count %> ингредиентов</span>
        </div>
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
          <div class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200">
            <%= link_to new_project_ingredient_path(@project), data: { turbo_frame: 'modal' }, class: "block p-4 text-center h-full flex flex-col items-center justify-center" do %>
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-amber-50 mb-2">
                <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
              </div>
              <span class="text-sm font-medium text-stone-700">Добавить</span>
            <% end %>
          </div>

          <% @ingredients.each do |ingredient| %>
            <div id="ingredient_<%= ingredient.id %>" class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200 overflow-hidden">
              <%= render partial: 'ingredient_card', locals: { ingredient: ingredient } %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div data-section-target="tag" class="hidden">
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-stone-800">Теги проекта</h3>
          <span class="text-sm text-stone-500"><%= @tags.count %> тегов</span>
        </div>
        <turbo-frame id="tags_section_cards" class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
          <div class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200">
            <%= link_to new_project_tag_path(@project), data: { turbo_frame: 'modal' }, class: "block p-4 text-center h-full flex flex-col items-center justify-center" do %>
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-amber-50 mb-2">
                <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
              </div>
              <span class="text-sm font-medium text-stone-700">Добавить</span>
            <% end %>
          </div>
          
          <% @tags.each do |tag| %>
            <div id="tag_<%= tag.id %>" class="aspect-square bg-white rounded-lg shadow-sm border border-stone-200 hover:shadow-md transition-shadow duration-200 overflow-hidden">
              <%= render partial: 'tag_card', locals: { tag: tag } %>
            </div>
          <% end %>
        </turbo-frame>
      </div>
    </div>
  </div>
</div>